<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>07 Data Fetching | Essential React</title>

    <link rel="icon" href="../img/zuehlke_logo.jpg" />
    <link rel="stylesheet" href="../dist/reset.css" />
    <link rel="stylesheet" href="../dist/reveal.css" />
    <link rel="stylesheet" href="../css/theme/zuehlke.css" />

    <!-- Theme used for syntax highlighted code -->
    <link rel="stylesheet" href="../plugin/highlight/monokai.css" />
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <section class="deck-slide">
          <h1>
            Essential React <br />
            07 Data Fetching
          </h1>
        </section>
        <section>
          <section>
            <p><img src="../img/data_fetching_goal.png" /></p>
            <p class="fragment">Where do we get this data from?</p>
          </section>
          <section>
            <h2>PokeAPI</h2>
            <a href="https://pokeapi.co/" target="_blank" rel="noopener noreferrer">
                Documentation
            </a>
        </section>
          <section>
            <h3>List of Pokemon</h3>
            <pre><code class="hljs json" data-trim data-line-numbers="|5-13"><script type="text/template">
                {
                  "count": 1118,
                  "next": "https://pokeapi.co/api/v2/pokemon?offset=5&limit=5",
                  "previous": null,
                  "results": [
                    {
                      "name": "bulbasaur",
                      "url": "https://pokeapi.co/api/v2/pokemon/1/"
                    },
                    {
                      "name": "ivysaur",
                      "url":"https://pokeapi.co/api/v2/pokemon/2/"
                    },
                    …
                  ]
                }
              </script></code></pre>
        <p>
          <a
            href="https://pokeapi.co/api/v2/pokemon?limit=5"
            target="_blank"
            rel="noopener noreferrer"
          >
            GET https://pokeapi.co/api/v2/pokemon?limit=5
          </a>
        </p>
          </section>
        </section>
        <section>
          <section><h2>What to use for data fetching?</h2></section>
          <section>
            <ul>
              <li>React does <em>not</em> provide data fetching</li>
              <li><span class="warn">Fetch:</span> standard browser API</li>
              <li>&hellip; or any data fetching library</li>
            </ul>
          </section>
          <section>
            <h3>Fetch</h3>
            <pre><code class="hljs typescript" data-trim data-line-numbers="1-4|6-9|11-12|"><script type="text/template">
                // Send the request and wait for the response
                const response = await fetch(
                  'https://example.com/data'
                );

                // Did we get a response status code other than 2XX?
                if (!response.ok) {
                  throw new Error("Could not fetch data!");
                }

                // Deserialize the JSON response body
                const data = await response.json();
              </script></code></pre>
          </section>
        </section>
        <section>
          <section><h2>How do we use fetch in React?</h2></section>
          <section>
            <p>Does this work?</p>
            <pre><code class="hljs jsx" data-trim data-line-numbers="|2,5"><script type="text/template">
               function MyComponent() {
                 const response = await fetch('/user');
                 if (!response.ok) throw new Error('Could not fetch data!');   

                 const user = await response.json();   
                 
                 return <p>{user.name}</p>;
               }        
              </script></code></pre>
            <p class="fragment">
              <span class="warn">Does not work!</span> &ndash; The render
              function is not async.
            </p>
          </section>
          <section>
            <p>Well, how about this?</p>
            <pre><code class="hljs jsx" data-trim data-line-numbers="|4,7|2,8,12"><script type="text/template">
               function MyComponent() {
                 let user;

                 fetch('/user').then(response => {
                   if (!response.ok) throw new Error('Could not fetch data!');

                   response.json().then(u => {
                     user = u;
                   });
                 });   
                 
                 return <p>{user?.name}</p>;
               }</script></code></pre>
            <p class="fragment">
              <span class="warn">Does not work!</span> &ndash; When the promise
              resolves, the render function already ran.
            </p>
          </section>
          <section>
              <p>Fetching data asynchronously requires state management.</p>
              <p><span class="warn">&rarr;useState</span></p>
          </section>
          <section>
            <pre><code class="hljs jsx" data-trim data-line-numbers="|4,7|2,8,12"><script type="text/template">
              function MyComponent() {
                const [user, setUser] = useState();

                fetch('/user').then(response => {
                  if (!response.ok) throw new Error('Could not fetch data!');

                  response.json().then(u => {
                    setUser(u);
                  });
                });   
                
                return <p>{user?.name}</p>;
              }</script></code></pre>
              <p class="fragment">
                <span class="warn">Bad!</span> &ndash; This produces an infinte loop.
              </p>
          </section>
          <section>
            <h3>Why we should <em>not</em> run side effects in the render function</h3>
            <ul>
              <li class="fragment">We don't want the side effect to execute with every render.</li>
              <li class="fragment">The render function might be executed anytime &ndash; we don't control it.</li>
              <li class="fragment">In the render function we just want to render and not spend computing on other tasks.</li>
            </ul>
          </section>
          <section data-auto-animate>
            <h3>The <span class="warn">useEffect</span> Hook</h3>
            <pre data-id="code"><code class="hljs jsx" data-trim data-line-numbers="1,5-9"><script type="text/template">
                 import { useEffect } from "react";

                 function MyComponent() {

                   useEffect(() => {

                     // Run side effect

                   }, [dependency1, dependency2]);

                   // …
                 }
                  </script></code></pre>
          </section>
          <section data-auto-animate>
            <p><pre data-id="code"><code class="hljs jsx" data-trim data-line-numbers="|5"><script type="text/template">
              
                   useEffect(() => {

                     // Run side effect

                   }, [dependency1, dependency2]);
                  </script></code></pre></p>
              <p>The effect is executed initially and whenever a dependency changes.</p>
          </section>
          <section data-auto-animate>
            <p><pre data-id="code"><code class="hljs jsx" data-trim data-line-numbers="5"><script type="text/template">
              
                   useEffect(() => {

                     // Run side effect

                   }, []);
                  </script></code></pre></p>
              <p>When passing an empty array, the effect is executed only initially (on first render).</p>
          </section>
          <section data-auto-animate>
            <p><pre data-id="code"><code class="hljs jsx" data-trim data-line-numbers="5"><script type="text/template">
              
                   useEffect(() => {

                     // Run side effect

                   });
                  </script></code></pre></p>
              <p>If no depencencies are passed, the effect is executed with every render.</p>
          </section>
          <section>
            <p>Let's call this API correctly!</p>
            <p><pre><code class="hljs jsx" data-trim data-line-numbers="|4-12|12|"><script type="text/template">
              function MyComponent() {
                const [user, setUser] = useState();

                useEffect(() => {
                  fetch('/user').then(response => {
                    if (!response.ok) throw new Error('Could not fetch data!');
  
                    response.json().then(u => {
                      setUser(u);
                    });
                  }); 
                }, [setUser]);
                
                return <p>{user?.name}</p>;
              }
            </script></code></pre></p>

              <p class="fragment"><em>Wait&hellip;</em> but what about <span class="warn">async-await?</span></p>
          </section>
          <section>
            <p>We cannot make the passed function async because</p>
            <p><pre><code class="hljs jsx" data-trim data-line-numbers="|4-12|12|">
              function MyComponent() {
                const [user, setUser] = useState();

                useEffect(() => {
                  fetch('/user').then(response => {
                    if (!response.ok) throw new Error('Could not fetch data!');
  
                    response.json().then(u => {
                      setUser(u);
                    });
                  }); 
                }, []);
                
                return &lt;p&gt;{user?.name}&lt;/p&gt;;
              }
              </code></pre></p>

              <p class="fragment"><em>Wait&hellip;</em> but what about <span class="warn">async-await?</span></p>
          </section>
        </section>
        <section>
          TODO custom hook
        </section>
        <section>
          <h2>Exercise</h2>

          <p>Show a list of pokemon.</p>
          <p><img src="../img/data_fetching_goal.png" /></p>
        </section>
        <section>
          <h2>Unsubscribe</h2>
        </section>
        <section class="deck-slide">
            <h1>Questions?</h1>
        </section>
      </div>
    </div>

    <script src="../dist/reveal.js"></script>
    <script src="../plugin/notes/notes.js"></script>
    <script src="../plugin/markdown/markdown.js"></script>
    <script src="../plugin/highlight/highlight.js"></script>
    <script>
      // More info about initialization & config:
      // - https://revealjs.com/initialization/
      // - https://revealjs.com/config/
      Reveal.initialize({
        hash: true,

        // Learn about plugins: https://revealjs.com/plugins/
        plugins: [RevealMarkdown, RevealHighlight, RevealNotes],
      });
    </script>
  </body>
</html>
