<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />

    <title>Remix | Essential React</title>

    <link rel="icon" href="../img/zuehlke_logo.jpg" />

    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/Zuehlke/zuehlke-reveal-package@f42658c99dec0812d754d935263a70b93b81f54b/release/index.css"
    />
  </head>

  <body>
    <div class="reveal">
      <div class="slides">
        <section class="title-slide">
          <h1>Remix</h1>
          <h3>Essential React</h3>
        </section>
        <section class="agenda" id="agenda-slide">
          <div class="wrapper">
            <div>
              <span class="number">01</span>
              <span class="title">Server-Side Rendering</span>
            </div>
            <div>
              <span class="number">02</span>
              <span class="title">Setup</span>
            </div>
            <div>
              <span class="number">03</span>
              <span class="title">Routing</span>
            </div>
            <div>
              <span class="number">04</span>
              <span class="title">Data Fetching</span>
            </div>
            <div>
              <span class="number">05</span>
              <span class="title">Forms & Actions</span>
            </div>
          </div>
        </section>

        <section class="subtitle-slide">
          <h1>Server-Side Rendering (SSR)</h1>
        </section>

        <section>
          <section>
            <h2>React Rendering Mechanisms</h2>
          </section>
          <section>
            <h3>Overview</h3>
            <img
              src="../img/rendering-mechanisms.png"
              alt="Rendering Mechanisms"
            />
          </section>
          <section>
            <h3>How does Pre-Rendering work?</h3>
            <img
              src="../img/pre-rendering-flow.png"
              alt="How does Pre-Rendering work?"
            />
          </section>
        </section>
        <section>
          <section>
            <h2>Remix</h2>
          </section>
          <section>
            <ul>
              <li>
                Created by Michael Jackson and Ryan Florence (same as React
                Router)
              </li>
              <li>Remix v1 in November 2021</li>
              <li><span class="hl">Use the Platform</span> philosophy</li>
              <li>Only Server-Side Rendering (no SSG)</li>
              <li>Supports <span class="hl">Progressive Enhancement</span></li>
            </ul>
            <aside class="notes">
              <p>Why do we use Remix for the course?</p>
              <ul>
                <li>
                  Example for classical <em>Server-Side Rendering</em> (SSR),
                  RSC is very new still
                </li>
                <li>
                  Same routing core as we have used for client-side rendered app
                  (powered by React Router)
                </li>
                <li>Next.js is currently in transition phase</li>
              </ul>
            </aside>
          </section>
          <section>
            <img
              src="../img/remix_website_screenshot.jpeg"
              alt="Remix Website Screenshot"
            />
            <a href="https://remix.run" target="_blank">remix.run</a>
          </section>
        </section>

        <section class="subtitle-slide">
          <h1>Setup</h1>
        </section>

        <section>
          <section>
            <h3>Create a new Remix app</h3>
          </section>
          <section>
            <pre><code class="hljs no-highlight" data-trim data-line-numbers="1|2-3|4-5|6-7|8-9|1-9|11|12|">
                $ npx create-remix@latest pokedex-remix
                  ? What type of app do you want to create?
                    > Just the basics
                  ? Where do you want to deploy?
                    > Remix App Server
                  ?  TypeScript or JavaScript?
                    > TypeScript
                  ?  Do you want me to run `npm install`?
                    > Yes
 
                $ cd ./pokedex-remix
                $ npm run dev
            </code></pre>
          </section>
        </section>

        <section>
          <section>
            <h3>File Structure</h3>
          </section>
          <section data-auto-animate>
            <img
              src="../img/remix_initial-files.png"
              alt="Initial files of Remix app folder"
              width="450"
            />
            <aside class="notes">Ask: What do you notice?</aside>
          </section>
          <section data-auto-animate>
            <div class="comparison">
              <div>
                <ul>
                  <li class="fragment" data-fragment-index="4">
                    <span class="code">app/routes/*.tsx</span><br />route files
                    (more details in next chapter)
                  </li>

                  <li class="fragment" data-fragment-index="2">
                    <span class="code">app/entry.*.tsx</span>
                    <br />complete control over server and client entry points
                    (optional)
                  </li>

                  <li class="fragment" data-fragment-index="3">
                    <span class="code">app/root.tsx</span><br />describes the
                    app's HTML document / root layout
                  </li>

                  <li class="fragment" data-fragment-index="5">
                    <span class="code">public/*</span><br />public asset files
                  </li>

                  <li class="fragment" data-fragment-index="1">
                    <span class="code">remix.config.js</span><br />dev server /
                    build options
                  </li>
                </ul>
              </div>
              <div>
                <img
                  src="../img/remix_initial-files.png"
                  alt="Initial files of Remix app folder"
                  width="450"
                />
              </div>
            </div>
          </section>
          <section>
            <h3><span class="code">app/root.tsx</span></h3>
            <pre><code class="hljs tsx" data-trim data-line-numbers="|8,9,14,15,20,21|2,12,13,16-19|16|1,4|"><script type="text/template">
import type { LinksFunction } from "@remix-run/node";
import { Links, LiveReload, Meta, … } from "@remix-run/react";

export const links: LinksFunction = () => […];

export default function App() {
  return (
    <html lang="en">
      <head>
        <meta charSet="utf-8" />
        <meta name="viewport" content="width=device-width,initial-scale=1" />
        <Meta />
        <Links />
      </head>
      <body>
        <Outlet />
        <ScrollRestoration />
        <Scripts />
        <LiveReload />
      </body>
    </html>
  );
}
          </script></code></pre>
            <aside class="notes">
              Some notes:
              <ol>
                <li>Describes complete document (&lt;html&gt; element)</li>
                <li>
                  Special Remix components for app setup (again, full control)
                </li>
                <li>
                  Router outlet (same as in React Router): your page is rendered
                  here
                </li>
                <li>
                  <em>links</em> export: e.g. global stylesheets. Conventions
                  explained in next chapter
                </li>
              </ol>
            </aside>
          </section>
        </section>

        <section>
          <section>
            <h3>NPM Scripts</h3>
            <p><span class="code">npm run dev</span></p>
            <p>Starts the app in dev mode with hot reload</p>
          </section>
          <section>
            <p><span class="code">npm run build</span></p>
            <p>
              Creates a production build of your app (output in
              <span class="code">build</span> and
              <span class="code">public/build</span> folders)
            </p>
          </section>
          <section>
            <p><span class="code">npm start</span></p>
            <p>
              Starts Node.js server in <span class="code">build</span> folder
            </p>
            <div class="tip fragment">
              For deployment to common platforms consider using a template (see
              <span class="code">README.md</span>)
            </div>
          </section>
          <section>
            <p><span class="code">npm run typecheck</span></p>
            <p>
              Runs TypeScript compiler to ensure type-safety in build pipeline
              (<em>not</em>
              done automatically by Remix compiler)
            </p>
          </section>
        </section>

        <section class="subtitle-slide">
          <h1>Routing</h1>
        </section>

        <section>
          <section>
            <h3>Intro to Route File Naming</h3>
          </section>
          <section>
            <h4>General conventions</h4>
            <ul>
              <li>
                Remix uses the same concepts and core logic as React Router
              </li>
              <li class="fragment">Use file names to define routes</li>
              <li class="fragment">
                Route files are placed in <span class="code">app/routes</span>
              </li>
              <li class="fragment">
                Flat file structure (no nested route folders)
              </li>
              <li class="fragment">
                Co-location of non-route files is possible
              </li>
            </ul>
            <aside class="notes">
              <ul>
                <li>
                  Although the routing core is the same as React Router (also
                  developed by Remix), in Remix routing is file-based
                </li>
                <li>
                  Flat file structure was introduced as new convention
                  (initially also used nested route folders). Legacy file
                  structure will not be supported anymore in Remix v2.
                </li>
              </ul>
            </aside>
          </section>
          <section data-auto-animate>
            <pre><code class="hljs no-highlight" data-trim data-line-numbers="1" data-id="code"><script type="text/template">
app/routes/
    ├── _index.tsx
    ├── about.tsx
    ├── pricing.tsx
    ├── blog._index.tsx
    ├── blog.$slug.tsx
    ├── blog.archive.tsx
    └── blog.authors.tsx
              </script></code></pre>
          </section>
          <section data-auto-animate>
            <p><span class="code">_index</span> indicates an index route</p>
            <pre><code class="hljs no-highlight" data-trim data-line-numbers="2,5" data-id="code"><script type="text/template">
app/routes/
    ├── _index.tsx
    ├── about.tsx
    ├── pricing.tsx
    ├── blog._index.tsx
    ├── blog.$slug.tsx
    ├── blog.archive.tsx
    └── blog.authors.tsx
              </script></code></pre>
            <p>
              &rarr; URLs <span class="code">/</span> and
              <span class="code">/blog</span>
            </p>
          </section>
          <section data-auto-animate>
            <p>Static route segments</p>
            <pre><code class="hljs no-highlight" data-trim data-line-numbers="3,4,7,8" data-id="code"><script type="text/template">
app/routes/
    ├── _index.tsx
    ├── about.tsx
    ├── pricing.tsx
    ├── blog._index.tsx
    ├── blog.$slug.tsx
    ├── blog.archive.tsx
    └── blog.authors.tsx
              </script></code></pre>
            <p>
              &rarr; e.g.
              <span class="code">/about</span> and<span class="code"
                >/blog/archive</span
              >
            </p>
          </section>
          <section data-auto-animate>
            <p>
              Use the dot delimiter for <span class="hl">nested routes</span>
            </p>
            <pre><code class="hljs no-highlight" data-trim data-line-numbers="5-8" data-id="code"><script type="text/template">
app/routes/
    ├── _index.tsx
    ├── about.tsx
    ├── pricing.tsx
    ├── blog._index.tsx
    ├── blog.$slug.tsx
    ├── blog.archive.tsx
    └── blog.authors.tsx
              </script></code></pre>
            <p>&rarr; URLs <span class="code">/blog/…</span></p>
          </section>
          <section data-auto-animate>
            <p>
              Dynamic route segments (parameters) start with a dollar symbol
            </p>
            <pre><code class="hljs no-highlight" data-trim data-line-numbers="6" data-id="code"><script type="text/template">
app/routes/
    ├── _index.tsx
    ├── about.tsx
    ├── pricing.tsx
    ├── blog._index.tsx
    ├── blog.$slug.tsx
    ├── blog.archive.tsx
    └── blog.authors.tsx
              </script></code></pre>
            <p>
              &rarr; e.g.
              <span class="code">/blog/five-great-tips-for-2024</span>
            </p>
          </section>
          <section>
            See
            <a
              href="https://remix.run/docs/en/1.19.3/file-conventions/route-files-v2"
              >Remix docs</a
            >
            for more details.
          </section>
        </section>
        <section>
          <section data-auto-animate>
            <h3>Route Module API</h3>
          </section>
          <section data-auto-animate>
            <h3>Route Module API</h3>

            <pre><code class="hljs no-highlight" data-trim data-line-numbers="6" data-id="code"><script type="text/template">
              app/routes/
                  ├── _index.tsx
                  ├── about.tsx
                  ├── pricing.tsx
                  ├── blog._index.tsx
                  ├── blog.$slug.tsx
                  ├── blog.archive.tsx
                  └── blog.authors.tsx
                            </script></code></pre>
          </section>
          <section>
            <p><span class="code">blog.$slug.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="|3,10|5-9|1,4" data-id="code"><script type="text/template">
          import { useParams } from "@remix-run/react";

          export default function BlogPostPage() {
            const { slug } = useParams<'slug'>();
            return (
              <p>
                This is the blog post with slug {slug}.
              </p>
            );
          }
        </script></code></pre>
            <aside class="notes">
              <ol>
                <li>Must be default export</li>
                <li>It's a React component, return JSX</li>
                <li>
                  useParams like in React Router (Disclaimer: just as an example
                  – Data fetching will work differently -> later)
                </li>
              </ol>
            </aside>
          </section>
          <section data-auto-animate>
            <p>How can we redirect to a different route?</p>

            <p class="fragment">
              E.g. <span class="code">/</span> &rarr;
              <span class="code">/blog</span>
            </p>
          </section>
          <section data-auto-animate>
            <p>How can we redirect to a different route?</p>
            <p>
              E.g. <span class="code">/</span> &rarr;
              <span class="code">/blog</span>
            </p>

            <div>
              <p><span class="code">_index.tsx</span></p>
              <pre><code class="hljs tsx" data-trim data-line-numbers="3,5|1,4|" data-id="code"><script type="text/template">
import { redirect } from "@remix-run/node";

export function loader() {
  return redirect("blog");
}
        </script></code></pre>
              <p class="fragment">
                Must be a named export called <span class="code">loader</span>.
              </p>
              <aside class="notes">
                <ul>
                  <li>We will learn more about loaders in the next section.</li>
                  <li>
                    Depending on how the URL is reached, this redirect is either
                    performed server-side or client-side
                  </li>
                </ul>
              </aside>
            </div>
          </section>
          <section data-auto-animate>
            <div>
              <p><span class="code">_index.tsx</span></p>
              <pre><code class="hljs tsx" data-trim data-line-numbers data-id="code"><script type="text/template">
import { redirect } from "@remix-run/node";

export function loader() {
  return redirect("blog");
}
        </script></code></pre>
              <p>&rarr; redirects to <span class="code">blog.tsx</span></p>
            </div>
          </section>
          <section>
            <h4>Other Useful Route Module Exports</h4>

            <pre><code class="hljs tsx" data-trim data-line-numbers="21-23|1-7|9-15|17-19|" data-id="code"><script type="text/template">
              export const links: LinksFunction = () => {
                return [
                  { rel: "icon", href: "/favicon.png", type: "image/png" },
                  { rel: "stylesheet", href: "https://example.com/some/styles.css" },
                  …
                ];
              };

              export const meta: V2_MetaFunction = () => {
                return [
                  { title: "Very cool app | Remix" },
                  { property: "og:title", content: "Very cool app" },
                  …
                ];
              };

              export const headers: HeadersFunction = () => ({
                "Cache-Control": "max-age=300, s-maxage=3600",
              });

              export default function BlogPostPage() {
                …
              }
            </script></code></pre>

            <aside class="notes">
              And there are more… We will get to know loaders and actions in
              later sections.
            </aside>
          </section>
        </section>
        <section>
          <h2>Exercise</h2>
          <ol>
            <li>
              <span class="code">npx create-remix@latest &lt;app-name&gt;</span>
            </li>
            <li>
              Set up routes for pokemon list, pokemon detail, and profile pages
            </li>
            <li>Display mock data</li>
          </ol>
        </section>
        <section>
          <section>
            <h2>Solution</h2>
          </section>
          <section>
            <pre><code class="hljs no-highlight" data-trim data-line-numbers="6" data-id="code"><script type="text/template">
              app/routes/
                  ├── _index.tsx
                  ├── pokemon._index.tsx
                  ├── pokemon.$pokemonName.tsx
                  └── profile.tsx
            </script></code></pre>
          </section>
          <section>
            <p><span class="code">_index.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="" data-id="code"><script type="text/template">
              export function loader() {
                return redirect("pokemon");
              }                     
            </script></code></pre>
          </section>
          <section>
            <p><span class="code">pokemon._index.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="" data-id="code"><script type="text/template">
              export default function ListPage() {
                return <PokeList pokemons={pokemonList.results} />;
              }                        
            </script></code></pre>
          </section>
          <section>
            <p><span class="code">pokemon.$pokemonName.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="" data-id="code"><script type="text/template">
              export default function DetailPage() {
                const { pokemonName } = useParams<"pokemonName">();
              
                const pokemon = pokeDetails.find((p) => p.name === pokemonName);
              
                return (
                  <div>
                    <span>{pokemonName}</span>
                    <img src={pokemon?.sprites.front_shiny} alt={pokemonName} />
                  </div>
                );
              }                          
            </script></code></pre>
          </section>
          <section>
            <p>
              Complete solution code can be found on GitHub on the branch
              <a
                href="https://github.com/webplatformz/react-pokedex-remix/tree/exercise-02-routing"
                target="_blank"
                ><span class="code">exercise-02-routing</span></a
              >.
            </p>
          </section>
        </section>

        <section class="subtitle-slide">
          <h1>Data Fetching</h1>
        </section>
        <section>
          <section data-auto-animate data-auto-animate-id="1">
            <h2>Loaders</h2>
          </section>
          <section data-auto-animate data-auto-animate-id="1">
            <h2>Loaders</h2>
            <ul>
              <li class="fragment">
                Single, optional loader per route (export
                <span class="code">loader</span>)
              </li>
              <li class="fragment">Run on the server (only)</li>
              <li class="fragment">
                Define a HTTP endpoint: request &rarr; response
              </li>
              <li class="fragment">
                <span class="code">useLoaderData</span> to access response data
                in component
              </li>
            </ul>
          </section>
          <section>
            <p><span class="code">blog.$slug.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1,4,10|2,5-9|2,13-15" data-id="code"><script type="text/template">
              import type { LoaderArgs } from "@remix-run/node";
              import { json, useLoaderData } from "@remix-run/node";

              export async function loader({ request, params, context }: LoaderArgs) {
                if (!params.slug) throw new Error("slug is required");

                const post = await getBlogPost(params.slug);

                return json(post);
              }

              export default function BlogPostPage() {
                const post = useLoaderData<typeof loader>();

                return <pre>{JSON.stringify(post, null, 2)}</pre>;
              }
            </script></code></pre>
            <aside class="notes">
              <ul>
                <li>
                  type parameter of useLoaderData infers the type of the
                  returned data
                </li>
                <li>request is the Fetch API Request interface</li>
                <li>
                  params has route parameters (use request for query params)
                </li>
                <li>On initial request runs internally on server</li>
                <li>
                  When navigating to the page within SPA, performs background
                  request
                </li>
              </ul>
            </aside>
          </section>
          <section data-auto-animate>
            <h3>Modifying the HTTP response</h3>
          </section>
          <section data-auto-animate>
            <h3>Modifying the HTTP response</h3>

            <p>Return a <span class="code">Response</span> object…</p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="4-6" data-id="code-1"><script type="text/template">
              export async function loader({ request, params, context }: LoaderArgs) {
                …

                if (notFound) {
                  return new Response(null, { status: 404, statusText: "Not found" });
                }

                return json(data);
              }
            </script></code></pre>
            <aside class="notes">
              <ul>
                <li>Also useful for 400 (Bad Request) or modifying headers</li>
              </ul>
            </aside>
          </section>
          <section data-auto-animate>
            <h3>Modifying the HTTP response</h3>
            <p>…or <em>throw</em> it!</p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="9,17|12-14|4-6" data-id="code-2"><script type="text/template">
              export async function loader({ request, params, context }: LoaderArgs) {
                …

                const post = await getBlogPost(params.slug);

                return json(data);
              }

              export async function getBlogPost(slug: string) {
                …

                if (notFound) {
                  throw new Response(null, { status: 404, statusText: "Not found" });
                }

                return post;
              }
            </script></code></pre>
            <aside class="notes">
              <ul>
                <li>This way, we don't need an if in the loader</li>
                <li>
                  Also doesn't break inference of the loader data like an if
                  would
                </li>
              </ul>
            </aside>
          </section>
        </section>
        <section>
          <h2>Exercise</h2>
          <ul>
            <li class="fragment">
              Load the data for the list and detail pages from the Poke API
            </li>
            <li class="fragment">
              Show the Not Found page if an unknown pokemon name is passed in
              the URL
            </li>
            <li class="fragment">
              <span class="hl">Stretch goal:</span> Transform the data from the
              PokeAPI so that only the needed data is sent to the client
            </li>
            <aside class="notes">
              <ul>
                <li>
                  Hint: Inspect the Network Tab to better understand how Remix
                  works.
                  <ul>
                    <li>
                      What is loaded upon redirect, document load, and
                      subsequent navigation?
                    </li>

                    <li>Make sure to not only look at Fetch/XHR requests.</li>
                  </ul>
                </li>
              </ul>
            </aside>
          </ul>
        </section>
        <section>
          <section>
            <h2>Solution</h2>
          </section>
          <section>
            <p><span class="code">fetcher.ts</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="|4-6" data-id="code"><script type="text/template">
              export async function fetcher<T>(uri: string, init?: RequestInit): Promise<T> {
                const response = await fetch(uri, init);
              
                if (response.status === 404) {
                  throw new Response(null, { status: 404, statusText: "Not found" });
                }

                if (!response.ok) throw new Error("Could not fetch data!");
                return response.json();
              }
            </script></code></pre>
          </section>
          <section>
            <p><span class="code">pokemon._index.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1-7|10|11|" data-id="code"><script type="text/template">
              export async function loader() {
                const pokemonList = await fetcher<PokemonResultDto>(
                  "https://pokeapi.co/api/v2/pokemon?limit=1000",
                );
              
                return json(pokemonList.results.map((p) => p.name));
              }
              
              export default function ListPage() {
                const pokemons = useLoaderData<typeof loader>();
                return <PokeList pokemons={pokemons} />;
              }
            </script></code></pre>
          </section>
          <section>
            <p><span class="code">pokemon.$pokemonName.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1-10|13|14-19|" data-id="code"><script type="text/template">
              export async function loader({ params }: LoaderArgs) {
                const pokemonDetail = await fetcher<PokemonDetailDto>(
                  `https://pokeapi.co/api/v2/pokemon/${params.pokemonName}`,
                );
              
                return json({
                  name: pokemonDetail.name,
                  imageUrl: pokemonDetail.sprites.front_shiny,
                });
              }
              
              export default function DetailPage() {
                const pokemonDetail = useLoaderData<typeof loader>();
                return (
                  <div>
                    <span>{pokemonDetail.name}</span>
                    <img src={pokemonDetail.imageUrl} alt={pokemonDetail.name} />
                  </div>
                );
              }
            </script></code></pre>
          </section>
          <section>
            <p>
              Complete solution code can be found on GitHub on the branch
              <a
                href="https://github.com/webplatformz/react-pokedex-remix/tree/exercise-03-data-fetching"
                target="_blank"
                ><span class="code">exercise-03-data-fetching</span></a
              >.
            </p>
          </section>
        </section>

        <section class="subtitle-slide">
          <h1>Forms & Actions</h1>
        </section>
        <section>
          <section>
            <h2>Creating a form</h2>
          </section>
          <section data-auto-animate>
            <p><span class="code">blog.$slug.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="5,9|6-8|" data-id="code-1"><script type="text/template">
            export default function BlogPostPage() {
              return (
                <>
                  …
                  <form method="post">
                    <input type="text" name="name" />
                    <textarea name="comment" />
                    <button type="submit">Submit</button>
                  </form>
                </>
              );
            }
        </script></code></pre>
            <p>Let's start simple: We can use a native HTML form.</p>
          </section>
          <section data-auto-animate>
            <p><span class="code">blog.$slug.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1,3" data-id="code-2"><script type="text/template">
              export async function action({ request }: ActionArgs) {
                …
              }

              export default function BlogPostPage() {
                return (
                  <>
                    …
                    <form method="post">
                      …
                      <button type="submit">Submit</button>
                    </form>
                  </>
                );
              }
        </script></code></pre>
            <p>
              On the server, the form is processed by an
              <span class="code">action</span>.
            </p>
          </section>
          <section data-auto-animate>
            <p><span class="code">blog.$slug.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="2-4" data-id="code-3"><script type="text/template">
              export async function action({ request }: ActionArgs) {
                const form = await request.formData();
                const name = form.get("name");
                const comment = form.get("comment");

                console.log(`name: ${name}`);
                console.log(`comment: ${comment}`);

                return redirect(".");
              }

              …
        </script></code></pre>
            <p>
              Form data is read from the request using the standard
              <a
                href="https://developer.mozilla.org/en-US/docs/Web/API/Request/formData"
                target="_blank"
                ><span class="code">Request.formData()</span></a
              >
              method.
            </p>
          </section>
          <section data-auto-animate>
            <p><span class="code">blog.$slug.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="6-7" data-id="code-3"><script type="text/template">
              export async function action({ request }: ActionArgs) {
                const form = await request.formData();
                const name = form.get("name");
                const comment = form.get("comment");

                console.log(`name: ${name}`);
                console.log(`comment: ${comment}`);

                return redirect(".");
              }

              …
        </script></code></pre>
            <p>
              The data can then be processed as desired (validated, stored,
              etc.).
            </p>
          </section>
          <section data-auto-animate>
            <p><span class="code">blog.$slug.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="9" data-id="code-3"><script type="text/template">
              export async function action({ request }: ActionArgs) {
                const form = await request.formData();
                const name = form.get("name");
                const comment = form.get("comment");

                console.log(`name: ${name}`);
                console.log(`comment: ${comment}`);

                return redirect(".");
              }

              …
        </script></code></pre>
            <p>
              Like the <span class="code">loader</span>, the
              <span class="code">action</span> function can return a Response
              object.<br />
              Typically, a <span class="code">redirect</span> is returned to
              implement the
              <a
                href="https://en.wikipedia.org/wiki/Post/Redirect/Get"
                target="_blank"
                >Post/Redirect/Get</a
              >
              pattern.
            </p>
          </section>
          <section data-auto-animate data-auto-animate-id="2">
            <p><span class="code">blog.$slug.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="7-11" data-id="code-2"><script type="text/template">
              …

              export default function BlogPostPage() {
                return (
                  <>
                    …
                    <form method="post">
                      <input type="text" name="name" />
                      <textarea name="comment" />
                      <button type="submit">Submit</button>
                    </form>
                  </>
                );
              }
        </script></code></pre>
            <p>
              What will happen when the user clicks the
              <em>Submit</em> button?
            </p>
            <p>
              &rarr; It works! But it does a <em>full document request</em>:
              <span class="code">POST&nbsp;/blog/…</span>
            </p>
          </section>
          <section data-auto-animate data-auto-animate-id="2">
            <p><span class="code">blog.$slug.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1,7,11" data-id="code-2"><script type="text/template">
              import { Form } from "@remix-run/react";

              export default function BlogPostPage() {
                return (
                  <>
                    …
                    <Form method="post">
                      <input type="text" name="name" />
                      <textarea name="comment" />
                      <button type="submit">Submit</button>
                    </Form>
                  </>
                );
              }
        </script></code></pre>
            <p>
              The Remix <span class="code">Form</span> component brings the
              expected SPA behavior.
            </p>
            <p class="fragment">
              It still has the native <span class="code">form</span> behavior as
              long as JS has not loaded yet.<br /><span class="hl"
                >&rarr; Progressive Enhancement</span
              >
            </p>
          </section>
        </section>
        <section>
          <section>
            <h2>Sessions and Cookies 🍪</h2>
          </section>
          <section data-auto-animate>
            <p>
              Remix has built-in support for
              <span class="hl">sessions</span>:
            </p>
            <ul>
              <li>Cookies</li>
              <li>Memory (dev only)</li>
              <li>File</li>
              <li>Cloudflare Workers</li>
              <li>Amazon DynamoDB</li>
            </ul>
          </section>
          <section data-auto-animate>
            <p>Let's work with the most versatile one:</p>
            <ul>
              <li>Cookies</li>
            </ul>
          </section>
          <section>
            <p><span class="code">app/sessions.ts</span></p>
            <pre
              class="fragment"
            ><code class="hljs ts" data-trim data-line-numbers="1,6,17|3,6|7-16|5,19|" data-id="code"><script type="text/template">
              import { createCookieSessionStorage } from "@remix-run/node";

              type SessionData = { … };

              const { getSession, commitSession, destroySession } =
                createCookieSessionStorage<SessionData>({
                  cookie: {
                    name: "__session",
                    domain: "localhost",
                    httpOnly: true,
                    maxAge: 60 * 60 * 24, /* cookie lives for 24 hours */
                    path: "/",
                    sameSite: "lax",
                    secrets: ["s3cret1"],
                    secure: true,
                  },
                });

              export { getSession, commitSession, destroySession };
            </script></code></pre>
            <p>We set up our session handling utilities.</p>
          </section>
          <section>
            <p>
              And can use them in server-side code (typically
              <em>loaders</em> and <em>actions</em>):
            </p>
            <pre><code class="hljs ts" data-trim data-line-numbers="|1-2|4-5|7-8|10-12|" data-id="code"><script type="text/template">
              /* Getting a session object from a request */
              const session = await getSession(request.headers.get("Cookie"));

              /* Reading a value from the session */
              const color = session.get("color");

              /* Update a value in the session */
              session.set("color", "orange");

              /* Commit a session in a Response (required if it was modified) */
              return redirect(…, {
                headers: { "Set-Cookie": await commitSession(session) },
              });
            </script></code></pre>
          </section>
        </section>
        <section>
          <section>
            <h2>Exercise</h2>
            <ul>
              <li class="fragment">
                Add a form for name and email to the Profile page
              </li>
              <li class="fragment">
                When the form is submitted, submit the data to the server and
                store name and email in a cookie
                <ul>
                  <li class="fragment">User stays on the same page</li>
                  <li class="fragment">
                    Use the session handling utilities provided on the next
                    slide
                  </li>
                </ul>
              </li>
              <li class="fragment">Display the name in the navigation bar</li>
            </ul>
            <aside class="notes">
              Do not build in validation yet, this will follow in the next
              exercise.
            </aside>
          </section>
          <section>
            <p><span class="code">app/sessions.ts</span></p>
            <pre><code class="hljs ts" data-trim data-line-numbers="" data-id="code"><script type="text/template">
              import { createCookieSessionStorage } from "@remix-run/node";

              type SessionData = {
                name: string;
                email: string;
              };

              const { getSession, commitSession, destroySession } =
                createCookieSessionStorage<SessionData>({
                  cookie: {
                    name: "__session",
                    domain: "localhost",
                    httpOnly: true,
                    maxAge: 60 * 60 * 24, /* cookie lives for 24 hours */
                    path: "/",
                    sameSite: "lax",
                    secrets: ["s3cret1"],
                    secure: true,
                  },
                });

              export { getSession, commitSession, destroySession };
            </script></code></pre>
          </section>
        </section>
        <section>
          <section>
            <h2>Solution</h2>
          </section>
          <section>
            <p><span class="code">app/components/profile/Profile.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1,20|3,18|6,10-15,17|" data-id="code"><script type="text/template">
                export function Profile() {
                  return (
                    <Form method="post">
                      <div>
                        <label htmlFor="name">Name: </label>
                        <input type="text" id="name" name="name" placeholder="Dr. React" />
                      </div>
                      <div>
                        <label htmlFor="email">E-Mail: </label>
                        <input
                          type="text"
                          placeholder="react@zuhlke.com"
                          id="email"
                          name="email"
                        />
                      </div>
                      <input type="submit" value="save" />
                    </Form>
                  );
                }
            </script></code></pre>
          </section>
          <section>
            <p><span class="code">app/routes/profile.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1,17|2|4-9|11-12|14-16|" data-id="code"><script type="text/template">
              export async function action({ request }: ActionArgs) {
                const session = await getSession(request.headers.get("Cookie"));
              
                const form = await request.formData();
                const name = form.get("name");
                const email = form.get("email");
              
                if (typeof name !== "string") throw new Error("name must be a string");
                if (typeof email !== "string") throw new Error("email must be a string");
              
                session.set("name", name);
                session.set("email", email);
              
                return redirect(".", {
                  headers: { "Set-Cookie": await commitSession(session) },
                });
              }

              …
            </script></code></pre>
          </section>
          <section>
            <p><span class="code">app/components/layout/Layout.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1-3,5,12" data-id="code"><script type="text/template">
              type LayoutProps = {
                username?: string;
              };
              
              export function Layout({ username }: LayoutProps) {
                return (
                  <div className={styles.root}>
                    <header>
                      <nav>
                        <Link to="/pokemon">Home</Link> | <Link to="/profile">Profile</Link>
                      </nav>
                      <span>{username && `Hello, ${username}`}</span>
                    </header>
                    <main>
                      <Outlet />
                    </main>
                  </div>
                );
              }
            </script></code></pre>
          </section>
          <section>
            <p><span class="code">app/root.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1,5|2-4|8|18|1-5,8,18" data-id="code"><script type="text/template">
              export async function loader({ request }: LoaderArgs) {
                const session = await getSession(request.headers.get("Cookie"));

                return json({ username: session.get("name") });
              }

              export default function App() {
                const { username } = useLoaderData<typeof loader>();
                return (
                  <html lang="en">
                    <head>
                      <meta charSet="utf-8" />
                      <meta name="viewport" content="width=device-width,initial-scale=1" />
                      <Meta />
                      <Links />
                    </head>
                    <body>
                      <Layout username={username} />
                      <ScrollRestoration />
                      <Scripts />
                      <LiveReload />
                    </body>
                  </html>
                );
              }
            </script></code></pre>
          </section>
          <section>
            <p>
              Complete solution code can be found on GitHub on the branch
              <a
                href="https://github.com/webplatformz/react-pokedex-remix/tree/exercise-04-forms-actions"
                target="_blank"
                ><span class="code">exercise-04-forms-actions</span></a
              >.
            </p>
          </section>
        </section>
        <section>
          <section>
            <h2>Validation <span class="fragment">(server-side)</span></h2>
            <aside class="notes">
              We want to build in server side validation as a minimum.
              Client-side validation can be added e.g. with
              <a href="https://remix-forms.seasoned.cc" target="_blank">
                <strong>Remix Forms</strong></a
              >.
            </aside>
          </section>
          <section data-auto-animate="">
            <p>What do we want to show in case of validation errors?</p>
            <p class="fragment" data-fragment-index="0">The form, with:</p>
            <ul>
              <li class="fragment" data-fragment-index="2">The field values</li>
              <li class="fragment" data-fragment-index="1">
                Validation error messages per field
              </li>
            </ul>
            <p class="fragment">
              Thus, what do we need to do differently in our action?
            </p>
          </section>
          <section data-auto-animate="">
            <pre><code class="hljs tsx" data-trim data-line-numbers="" data-id="code"><script type="text/template">
              export async function action({ request }: ActionArgs) {
                /* Get form data from request… */
                




                /* Process form data… */




              
                return redirect(…);
              }

              …
            </script></code></pre>
            <p>Thus, what do we need to do differently in our action?</p>
          </section>
          <section data-auto-animate="">
            <pre><code class="hljs tsx" data-trim data-line-numbers="4|5,10|6-9|4-10" data-id="code"><script type="text/template">
              export async function action({ request }: ActionArgs) {
                /* Get form data from request… */

                const requestIsValid = …
                if (!requestIsValid) {
                  return json(
                    { values: { name }, errors: { name: "Name is invalid" } },
                    { status: 400 }  
                  );
                }

                /* Process form data… */
              
                return redirect(…);
              }

              …
            </script></code></pre>
            <p class="fragment">
              If request is invalid, return a HTTP
              <span class="code">400</span> response with the field values and
              errors.
            </p>
          </section>
          <section>
            <p>
              In the component, <span class="code">useActionData</span> to
              access the data returned by the action:
            </p>

            <pre><code class="hljs tsx" data-trim data-line-numbers="4|12|14|" data-id="code"><script type="text/template">
              …

              export default function MyPage() {
                const actionData = useActionData<typeof action>();

                return <>
                  …
                  <Form method="post">
                    <input
                      type="text"
                      name="name"
                      defaultValue={actionData?.values.name}
                    />
                    {actionData?.errors.name}
                    …
                  </Form>
                </>;
              }
            </script></code></pre>
          </section>
        </section>
        <section>
          <section>
            <h2>Exercise</h2>
          </section>
          <section>
            <ul>
              <li>
                Validate the profile form, e.g.
                <ul>
                  <li>Name and email are required</li>
                  <li>Name is max. 25 characters</li>
                  <li>Email is a valid email address</li>
                </ul>
              </li>
              <li>Ensure the submitted data is displayed</li>
              <li>Show the validation error messages at the form fields</li>
            </ul>
          </section>
        </section>
        <section>
          <section>
            <h2>Solution</h2>
          </section>
          <section data-auto-animate="" data-auto-animate-id="1">
            <p><span class="code">app/routes/profile.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="4-8|13-17|20-21" data-id="code-1"><script type="text/template">
                export async function action({ request }: ActionArgs) {
                  …

                  const errors = validateProfile({ name, email });
                
                  if (hasErrors(errors)) {
                    return json({ values: { name, email }, errors }, { status: 400 });
                  }
                
                  …
                }

                function validateProfile({ name, email }: ProfileValues) { … }

                function hasErrors(errors: ProfileErrors) {
                  return Object.values(errors).length > 0;
                }
                
                export default function ProfilePage() {
                  const actionData = useActionData<typeof action>();
                  return <Profile values={actionData?.values} errors={actionData?.errors} />;
                }
            </script></code></pre>
          </section>
          <section data-auto-animate="" data-auto-animate-id="1">
            <p><span class="code">app/routes/profile.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="4,18|6-16" data-id="code-2"><script type="text/template">
              …

              function validateProfile({ name, email }: ProfileValues) {
                const errors: ProfileErrors = {};

                if (!name || typeof name !== "string") {
                  errors.name = "Name is required!";
                } else if (name.length > 25) {
                  errors.name = "The name should be max. 25 characters long!";
                }
              
                if (!email || typeof email !== "string") {
                  errors.email = "Email is required!";
                } else if (!email.match(/^[A-Z0-9._+-]+@[A-Z0-9.-]+\.[A-Z]{2,}$/i)) {
                  errors.email = "Invalid email!";
                }
              
                return errors;
              }

              …
            </script></code></pre>
          </section>
          <section data-auto-animate="" data-auto-animate-id="2">
            <p><span class="code">app/components/profile/Profile.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="1,4,15|2,6-9|3,11-13" data-id="code-1"><script type="text/template">
              type ProfileProps = {
                values?: ProfileValues;
                errors?: ProfileErrors;
              };
              
              export type ProfileValues = {
                name: string;
                email: string;
              };
              
              export type ProfileErrors = {
                [K in keyof ProfileValues]?: string;
              };

              export function Profile({ values, errors }: ProfileProps) { … }
            </script></code></pre>
          </section>
          <section data-auto-animate="" data-auto-animate-id="2">
            <p><span class="code">app/components/profile/Profile.tsx</span></p>
            <pre><code class="hljs tsx" data-trim data-line-numbers="9,18|8,17|11,20|" data-id="code-2"><script type="text/template">
              export function Profile({ values, errors }: ProfileProps) {
                return (
                  <Form method="post">
                    <div>
                      <label htmlFor="name">Name: </label>
                      <input
                        …
                        className={errors?.name ? styles.inputError : ""}
                        defaultValue={values?.name}
                      />
                      {errors?.name && <span>{errors.name}</span>}
                    </div>
                    <div>
                      <label htmlFor="email">E-Mail: </label>
                      <input
                        …
                        className={errors?.email ? styles.inputError : ""}
                        defaultValue={values?.email}
                      />
                      {errors?.email && <span>{errors.email}</span>}
                    </div>
                    <input type="submit" value="save" />
                  </Form>
                );
              }
            </script></code></pre>
          </section>
        </section>
        <section>
          <h2>Recap</h2>
          <p>We learned&hellip;</p>
          <ul>
            <li>What server-side rendering (SSR) is</li>
            <li>How to set up a Remix app</li>
            <li>How to do routing in Remix</li>
            <li>How to fetch data in Remix</li>
            <li>How to create and process forms in Remix</li>
          </ul>
        </section>
        <section class="break-slide">
          <h1>Questions?</h1>
        </section>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/gh/Zuehlke/zuehlke-reveal-package@f42658c99dec0812d754d935263a70b93b81f54b/release/index.js"></script>
    <script>
      setupZuehlkeRevealPresentation();
    </script>
  </body>
</html>
